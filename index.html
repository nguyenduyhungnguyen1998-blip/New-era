<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tam ThÃ¡i Tá»­</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ›ï¸</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
</head>
<body>
  <div id="greetingPopup" class="fullscreen-overlay" role="dialog" aria-modal="true" aria-labelledby="greetingTitle">
    <div class="box">
      <h2 id="greetingTitle" style="margin:0">ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ThÃ¡p HÃ  Ná»™i!</h2>
      <div style="color:var(--muted);margin-top:8px">Äá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t, báº¡n cÃ³ muá»‘n báº­t nháº¡c ná»n khÃ´ng?</div>
      <div style="margin-top:12px; display:flex; justify-content:center; gap: 12px;">
        <button id="musicYes" class="btn">CÃ³, báº­t nháº¡c</button>
        <button id="musicNo" class="ghost">KhÃ´ng, cáº£m Æ¡n</button>
      </div>
    </div>
  </div>

  <div id="tutorialPrompt" class="fullscreen-overlay" style="display:none" role="dialog" aria-modal="true">
    <div class="box">
      <h2 style="margin:0">ğŸ“– Báº¡n Ä‘Ã£ biáº¿t luáº­t chÆ¡i chÆ°a?</h2>
      <div style="color:var(--muted);margin-top:8px">ThÃ¡p HÃ  Ná»™i cÃ³ 3 luáº­t Ä‘Æ¡n giáº£n nhÆ°ng ráº¥t quan trá»ng!</div>
      <div style="margin-top:12px; display:flex; justify-content:center; gap: 12px;">
        <button id="tutorialYes" class="ghost">Biáº¿t rá»“i</button>
        <button id="tutorialNo" class="btn">HÃ£y hÆ°á»›ng dáº«n tÃ´i</button>
      </div>
    </div>
  </div>

  <div id="modeSelect" class="fullscreen-overlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="modeTitle">
    <div class="box">
      <h2 id="modeTitle" style="margin:0">Chá»n cháº¿ Ä‘á»™</h2>
      <div style="color:var(--muted);margin-top:8px">Báº¯t Ä‘áº§u báº±ng cÃ¡ch chá»n má»™t cháº¿ Ä‘á»™. Báº¡n cÃ³ thá»ƒ Ä‘á»•i láº¡i sau.</div>
      <div class="mode-grid" role="list">
        <button class="mode-card" id="mode-play" role="listitem"><h3>ğŸ® Play</h3><p>ChÆ¡i tá»± do: kÃ©o tháº£, tÃ­nh giá», lÆ°u ká»· lá»¥c.</p></button>
        <button class="mode-card" id="mode-teach" role="listitem"><h3>ğŸ’¡Play with hint</h3><p>Há»c cÃ¡ch giáº£i. Game sáº½ gá»£i Ã½ vÃ  chá» báº¡n Ä‘i Ä‘Ãºng.</p></button>
        <button class="mode-card" id="mode-learn" role="listitem"><h3>ğŸ§  Learn (recursion)</h3><p>Trá»±c quan hÃ³a thuáº­t toÃ¡n, call stack & tá»«ng bÆ°á»›c.</p></button>
        <button class="mode-card" id="mode-challenge" role="listitem"><h3>â±ï¸ Challenge</h3><p>HoÃ n thÃ nh trong thá»i háº¡n. 3 cáº¥p Ä‘á»™ Dá»…/Vá»«a/KhÃ³.</p></button>
        <button class="mode-card" id="mode-sandbox" role="listitem"><h3>ğŸš€ Sandbox</h3><p>TÃ¹y chá»‰nh sá»‘ cá»™t vÃ  luáº­t chÆ¡i cá»§a riÃªng báº¡n.</p></button>
      </div>
      <div style="margin-top:12px;display:flex;justify-content:center"><button id="modeStart" class="btn">XÃ¡c nháº­n</button></div>
    </div>
  </div>
  
  <div id="sandboxSetupPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="sandboxTitle">
        <div class="popup-box" style="max-width:620px;max-height:90vh;overflow-y:auto">
            <h3 id="sandboxTitle" style="margin:0 0 2px 0;text-align:center;font-size:18px">ğŸš€ Sandbox Mode</h3>
            <p style="font-size:11px;color:var(--muted);text-align:center;margin:0 0 10px 0">TÃ¹y chá»‰nh luáº­t chÆ¡i cá»§a riÃªng báº¡n</p>
            
            <!-- 2-Column Layout for Compact View -->
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px">
                <!-- Left Column: Basic Config + Rules -->
                <div>
                    <!-- Basic Config -->
                    <div style="background:rgba(43,140,255,0.06);padding:10px;border-radius:8px;margin-bottom:8px;border:1px solid rgba(43,140,255,0.12)">
                        <h4 style="margin:0 0 8px 0;font-size:12px;font-weight:700;color:var(--accent)">âš™ï¸ Cáº¥u hÃ¬nh</h4>
                        <div style="margin-bottom:8px">
                            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px">ğŸ”¢ ÄÄ©a: <span id="sandboxDisksValue" style="color:var(--accent);font-size:14px;font-weight:800">4</span></label>
                            <input type="range" id="sandboxDisks" min="2" max="12" value="4" style="width:100%">
                            <div style="display:flex;justify-content:space-between;font-size:9px;color:var(--muted);margin-top:1px">
                                <span>Dá»…</span><span>Vá»«a</span><span>KhÃ³</span>
                            </div>
                        </div>
                        <div>
                            <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px">ğŸ›ï¸ Cá»™t: <span id="sandboxPolesValue" style="color:var(--accent);font-size:14px;font-weight:800">4</span></label>
                            <input type="range" id="sandboxPoles" min="3" max="8" value="4" style="width:100%">
                            <div style="display:flex;justify-content:space-between;font-size:9px;color:var(--muted);margin-top:1px">
                                <span>3</span><span>5-6</span><span>8</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Rules -->
                    <div style="background:rgba(139,92,246,0.06);padding:10px;border-radius:8px;border:1px solid rgba(139,92,246,0.12)">
                        <h4 style="margin:0 0 6px 0;font-size:12px;font-weight:700;color:#8b5cf6">ğŸ“œ Luáº­t</h4>
                        <select id="sandboxRule" style="width:100%;font-size:12px;padding:6px;border-radius:6px;border:2px solid rgba(139,92,246,0.2);font-weight:600;margin-bottom:6px">
                            <option value="classic">âœ¨ Classic</option>
                            <option value="cyclic">ğŸ”„ Cyclic</option>
                            <option value="adjacent">ğŸ”— Adjacent</option>
                        </select>
                        <div id="sandboxRuleDescBox" style="background:rgba(255,255,255,0.7);padding:7px;border-radius:6px;border-left:3px solid #8b5cf6">
                            <p id="sandboxRuleDesc" style="font-size:10px;color:#374151;margin:0;line-height:1.4;font-weight:500">Tá»± do di chuyá»ƒn giá»¯a cÃ¡c cá»™t.</p>
                            <div id="sandboxRuleExample" style="font-size:9px;color:var(--muted);margin-top:4px;padding-top:4px;border-top:1px solid rgba(0,0,0,0.06)">
                                <strong>VD:</strong> 1â†’2,3,4. Tá»± do!
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column: Start/Target + Presets -->
                <div>
                    <!-- Start & Target -->
                    <div style="background:rgba(34,197,94,0.06);padding:10px;border-radius:8px;margin-bottom:8px;border:1px solid rgba(34,197,94,0.12)">
                        <h4 style="margin:0 0 8px 0;font-size:12px;font-weight:700;color:#22c55e">ğŸ¯ Start & Target</h4>
                        <div style="margin-bottom:6px">
                            <label style="font-size:11px;font-weight:600;display:block;margin-bottom:3px">ğŸ“ Start:</label>
                            <select id="sandboxStartPos" style="width:100%;font-size:11px;padding:5px;border-radius:6px;border:2px solid rgba(34,197,94,0.2);font-weight:600">
                                <option value="classic">ğŸ”µ Cá»™t 1</option>
                                <option value="spread">ğŸŒŠ Spread</option>
                                <option value="last_pole">ğŸ”´ Cuá»‘i</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size:11px;font-weight:600;display:block;margin-bottom:3px">ğŸ¯ Target:</label>
                            <select id="sandboxTarget" style="width:100%;font-size:11px;padding:5px;border-radius:6px;border:2px solid rgba(34,197,94,0.2);font-weight:600">
                                <option value="any_other">âœ… Any</option>
                                <option value="last_pole">ğŸª Cuá»‘i</option>
                                <option value="specific">ğŸ¯ Chá»‰ Ä‘á»‹nh</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Quick Presets -->
                    <div style="background:rgba(255,193,7,0.06);padding:10px;border-radius:8px;border:1px solid rgba(255,193,7,0.12)">
                        <h4 style="margin:0 0 6px 0;font-size:12px;font-weight:700;color:#f59e0b">âš¡ Presets</h4>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:5px">
                            <button class="ghost" id="preset4col" style="font-size:10px;padding:5px 4px">ğŸ¯ 4col</button>
                            <button class="ghost" id="preset5col" style="font-size:10px;padding:5px 4px">ğŸš€ 5col</button>
                            <button class="ghost" id="presetHard" style="font-size:10px;padding:5px 4px">ğŸ”¥ Cyclic</button>
                            <button class="ghost" id="presetExtreme" style="font-size:10px;padding:5px 4px">ğŸ’ª 8x12</button>
                            <button class="ghost" id="presetAdjacent" style="font-size:10px;padding:5px 4px">ğŸ”„ Adj</button>
                            <button class="ghost" id="presetSpread" style="font-size:10px;padding:5px 4px">ğŸŒŠ Spread</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Summary Box - Full Width -->
            <div style="background:linear-gradient(135deg,rgba(255,193,7,0.08),rgba(255,152,0,0.08));padding:8px 10px;border-radius:6px;margin-bottom:10px;border:1px dashed rgba(255,152,0,0.3)">
                <div style="font-size:10px;font-weight:600;color:#f57c00;margin-bottom:2px">ğŸ’¡ Cáº¥u hÃ¬nh:</div>
                <div id="sandboxSummary" style="font-size:11px;color:#333;line-height:1.4">
                    Äang táº£i...
                </div>
            </div>
            
            <div style="display:flex;gap:6px;justify-content:center">
                <button id="sandboxStart" class="btn" style="padding:8px 28px;font-size:13px;font-weight:800">ğŸš€ Báº¯t Ä‘áº§u</button>
            </div>
        </div>
    </div>


  <!-- About Popup -->
  <div id="aboutPopup" class="popup" style="display:none">
    <div class="popup-box" style="max-width:480px">
      <h3 style="margin:0 0 12px 0;text-align:center">âœ¨ About âœ¨</h3>
      
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:48px;margin:8px 0">ğŸ›ï¸</div>
        <p style="font-size:15px;font-weight:600;color:var(--accent);margin:0">ThÃ¡p HÃ  Ná»™i - Brahma Tower</p>
      </div>
      
      <div style="background:rgba(139,92,246,0.08);padding:12px;border-radius:8px;margin-bottom:12px">
        <p style="margin:0 0 8px;font-size:13px;line-height:1.6"><strong>ğŸŒŸ Äiá»u kÃ¬ diá»‡u:</strong> BÃ i toÃ¡n tÆ°á»Ÿng Ä‘Æ¡n giáº£n nhÆ°ng chá»©a Ä‘á»±ng sá»©c máº¡nh toÃ¡n há»c phi thÆ°á»ng!</p>
        <p style="margin:0;font-size:13px;line-height:1.6">Vá»›i chá»‰ <strong>3 Ä‘Ä©a</strong> = 7 bÆ°á»›c, nhÆ°ng <strong>12 Ä‘Ä©a</strong> = 4,095 bÆ°á»›c tá»‘i Æ°u! CÃ²n 64 Ä‘Ä©a? Pháº£i máº¥t <strong>18 tá»· tá»· nÄƒm</strong> Ä‘á»ƒ hoÃ n thÃ nh! ğŸ¤¯</p>
      </div>
      
      <div style="margin-bottom:12px">
        <p style="font-size:13px;margin:0 0 6px;line-height:1.5">âš¡ <strong>Thuáº­t toÃ¡n Ä‘á»‡ quy</strong> - visualization call stack</p>
        <p style="font-size:13px;margin:0 0 6px;line-height:1.5">ğŸ¯ <strong>5 game modes</strong> - tá»« há»c Ä‘áº¿n thÃ¡ch thá»©c</p>
        <p style="font-size:13px;margin:0 0 6px;line-height:1.5">ğŸš€ <strong>Sandbox</strong> - tÃ¹y chá»‰nh cá»™t, luáº­t, tráº£i nghiá»‡m vÃ´ táº­n</p>
        <p style="font-size:13px;margin:0;line-height:1.5">ğŸ† <strong>39 achievements</strong> - thá»­ thÃ¡ch báº£n thÃ¢n</p>
      </div>
      
      <p style="font-size:12px;color:var(--muted);text-align:center;margin:12px 0 0">Made with â¤ï¸ by 6 Team Â© 2025</p>
      
      <div style="text-align:center;margin-top:12px">
        <button class="btn" onclick="this.closest('.popup').style.display='none'" style="padding:6px 20px">ÄÃ³ng</button>
      </div>
    </div>
  </div>

  <!-- Rules Popup -->
  <div id="rulesPopup" class="popup" style="display:none">
    <div class="popup-box" style="max-width:460px">
      <h3 style="margin:0 0 12px 0;text-align:center">ğŸ“– Luáº­t ChÆ¡i</h3>
      
      <div style="background:linear-gradient(135deg,rgba(59,130,246,0.1),rgba(139,92,246,0.1));padding:12px;border-radius:8px;margin-bottom:12px">
        <p style="margin:0;font-size:14px;font-weight:600;text-align:center">ğŸ¯ Má»¥c tiÃªu: Chuyá»ƒn táº¥t cáº£ Ä‘Ä©a sang cá»™t khÃ¡c</p>
      </div>
      
      <div style="margin-bottom:12px">
        <p style="font-size:13px;font-weight:600;margin:0 0 8px">âœ… Luáº­t core (báº¯t buá»™c):</p>
        <ol style="margin:0;padding-left:20px;font-size:13px;line-height:1.7">
          <li>Chá»‰ di chuyá»ƒn <strong>1 Ä‘Ä©a</strong> má»—i láº§n</li>
          <li>Chá»‰ di chuyá»ƒn Ä‘Ä©a <strong>á»Ÿ trÃªn cÃ¹ng</strong></li>
          <li><strong>ÄÄ©a nhá»</strong> luÃ´n náº±m trÃªn <strong>Ä‘Ä©a lá»›n</strong></li>
        </ol>
      </div>
      
      <div style="background:rgba(251,191,36,0.1);padding:10px;border-radius:6px;margin-bottom:12px">
        <p style="margin:0 0 6px;font-size:12px;font-weight:600">ğŸ’¡ Máº¹o:</p>
        <p style="margin:0;font-size:12px;line-height:1.5">â€¢ Sá»‘ bÆ°á»›c tá»‘i Æ°u = <code style="background:rgba(0,0,0,0.1);padding:2px 4px;border-radius:3px">2^n - 1</code></p>
        <p style="margin:4px 0 0;font-size:12px;line-height:1.5">â€¢ 3 Ä‘Ä©a = 7 bÆ°á»›c | 8 Ä‘Ä©a = 255 bÆ°á»›c | 12 Ä‘Ä©a = 4,095 bÆ°á»›c!</p>
      </div>
      
      <div style="margin-bottom:12px">
        <p style="font-size:13px;font-weight:600;margin:0 0 6px">ğŸ® Controls:</p>
        <p style="font-size:12px;margin:0 0 3px;line-height:1.5">â€¢ <strong>KÃ©o & tháº£</strong> Ä‘Ä©a Ä‘á»ƒ di chuyá»ƒn</p>
        <p style="font-size:12px;margin:0 0 3px;line-height:1.5">â€¢ <strong>Undo</strong> - hoÃ n tÃ¡c nÆ°á»›c Ä‘i</p>
        <p style="font-size:12px;margin:0;line-height:1.5">â€¢ <strong>Auto-solve</strong> - xem giáº£i phÃ¡p tá»‘i Æ°u</p>
      </div>
      
      <div style="text-align:center;margin-top:12px">
        <button class="btn" onclick="this.closest('.popup').style.display='none'" style="padding:6px 20px">Hiá»ƒu rá»“i!</button>
      </div>
    </div>
  </div>

  <div class="app" id="app">
    <div class="header">
      <h1>Brahma Tower</h1>
      <div id="titleDisplayContainer" class="title-container">
        <span id="titleDisplay" class="title-badge" title="Click Ä‘á»ƒ xem vÃ  Ä‘á»•i danh hiá»‡u">TÃ¢n Binh</span>
      </div>
      <div class="kv" style="margin-left: 12px; font-weight: 600;">Mode: <span id="currentModeDisplay" style="color: var(--accent);">Play</span></div>
      <div class="topmeta">
        <div class="badge-row">
          <div class="badge">Moves: <span id="mv" aria-live="polite">0</span></div>
          <div id="best-score-display" class="badge">Best (<span id="best-n">4</span> Ä‘Ä©a): <span id="best">â€”</span></div>
          <div id="sandbox-status" class="badge" style="display: none;">Sandbox Mode</div>
          <div class="badge">Time: <span id="tm" aria-live="polite">00:00</span></div>
        </div>
      </div>
    </div>

    <div class="controls">
      <div class="row">
        <label>Sá»‘ Ä‘Ä©a: <input id="n" type="number" min="1" max="12" value="4"></label>
        <label>Theme:
          <select id="theme" class="theme-select">
            <option value="classic">âœ¨ Classic</option><option value="burger">ğŸ” Burger</option><option value="rescue">ğŸ± MÃ¨o</option><option value="neon">ğŸŒˆ Neon</option><option value="dark">ğŸŒ™ Dark Cozy</option>
          </select>
        </label>
        <button id="rulesBtn" class="ghost" style="padding:5px 8px;font-size:12px" title="Luáº­t chÆ¡i">ğŸ“–</button>
        <button id="aboutBtn" class="ghost" style="padding:5px 8px;font-size:12px" title="Vá» game">â„¹ï¸</button>
        <div style="margin-left:auto;display:flex;gap:6px;align-items:center">
             <button id="statsBtn" class="ghost" style="padding:5px 8px;font-size:12px" title="Thá»‘ng kÃª">ğŸ“Š</button>
             <button id="missionBtn" class="ghost" style="padding:5px 8px;font-size:12px" title="Mission">ğŸ¯</button>
             <label class="kv">Ã‚m: <input id="snd" type="checkbox" checked></label>
             <button id="settingsBtn" class="ghost" style="padding:5px 8px;font-size:12px" title="CÃ i Ä‘áº·t">âš™ï¸</button>
        </div>
      </div>

      <div class="row" style="align-items:center">
        <label id="speedLabel" style="display: none;">Tá»‘c Ä‘á»™ (Auto/Learn):
          <select id="spd" class="speed-select"><option value="1200">Cháº­m</option><option value="700" selected>Vá»«a</option><option value="300">Nhanh</option></select>
        </label>
        <button class="btn" id="reset">Reset</button>
        <button class="ghost" id="changeMode">Äá»•i Cháº¿ Ä‘á»™</button>
        <button class="ghost" id="undo" disabled>Undo</button>
        <button class="ghost" id="auto">Auto-solve</button>
        <button class="ghost" id="hint">Gá»£i Ã½</button>
        <button class="ghost" id="analysisBtn">ğŸ† Leaderboard</button>
        <span id="sbInline" style="display:none;align-items:center;gap:8px">
          <label>Báº¯t Ä‘áº§u:
            <select id="sbStartInline" class="speed-select"></select>
          </label>
          <label>ÄÃ­ch:
            <select id="sbTargetInline" class="speed-select"></select>
          </label>
          <label>Luáº­t:
            <select id="sbRuleInline" class="speed-select">
              <option value="classic">Classic</option>
              <option value="adjacent">Adjacent</option>
              <option value="cyclic">Cyclic</option>
            </select>
          </label>
          <span id="sbFsInfo" class="kv" style="margin-left:8px;display:none"></span>
        </span>
        <div style="margin-left:auto;display:flex;gap:12px;align-items:center">
          <div class="progress" title="Tiáº¿n Ä‘á»™"><i id="prog"></i></div>
          <div class="hud"><div class="kv">HÆ°á»›ng dáº«n: <span id="hintText" aria-live="polite">â€”</span></div></div>
        </div>
      </div>
    </div>

    <div class="wrap-stage" id="stage">
      </div>
    <div class="footerNote">Máº¹o: KÃ©o tháº£ hoáº·c dÃ¹ng phÃ­m sá»‘ (1, 2, 3...) Ä‘á»ƒ chá»n cá»c vÃ  di chuyá»ƒn Ä‘Ä©a. Nháº¥n 'Esc' Ä‘á»ƒ há»§y.</div>
  </div>

  <div id="finish" class="finishPop"></div>
  
  <div id="errorPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="errorTitle">
    <div class="popup-box error-box">
      <div id="errorTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">âš ï¸ Di chuyá»ƒn khÃ´ng há»£p lá»‡!</div>
      <p id="errorPopupText" style="color:var(--muted);margin:0">KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t Ä‘Ä©a lá»›n lÃªn trÃªn Ä‘Ä©a nhá» hÆ¡n.</p>
      <div class="popup-actions"><button id="errorConfirm" class="btn">Hiá»ƒu rá»“i</button></div>
    </div>
  </div>

  <div id="hintPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="hintTitle">
    <div class="popup-box">
      <h3 id="hintTitle" style="margin-top:0">ğŸ’¡ Gá»£i Ã½</h3>
      <div id="hintTextPopup" style="text-align:left;margin:12px 0;line-height:1.6"></div>
      <div class="popup-actions"><button id="hintClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>

  <!-- Win Celebration Popups -->
  <div id="winPerfect" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-perfect">
      <div style="font-size:56px;margin-bottom:8px;line-height:1">ğŸ¯ğŸ†</div>
      <h3 style="margin:0 0 6px 0;color:#2b8cff;font-size:22px;font-weight:900">FLAWLESS!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:14px">âš¡ Äá»‰nh cao kÄ© thuáº­t!</p>
      <div style="font-weight:700;font-size:16px;margin:10px 0;color:#1f6ed6" id="winPerfectStats"></div>
      <div class="popup-actions"><button id="winPerfectClose" class="btn">ğŸš€ Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <div id="winGood" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-good">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸŒŸğŸ‘</div>
      <h3 style="margin:0 0 6px 0;color:#28a745;font-size:20px;font-weight:800">Xuáº¥t sáº¯c!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:14px">ğŸ”¥ Cáº­n ká» hoÃ n háº£o!</p>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#1e7e34" id="winGoodStats"></div>
      <div class="popup-actions"><button id="winGoodClose" class="btn">âœ¨ Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <div id="winSuccess" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-success">
      <div style="font-size:48px;margin-bottom:8px;line-height:1">âœ…ğŸ‰</div>
      <h3 style="margin:0 0 6px 0;color:#4b5563;font-size:19px;font-weight:700">HoÃ n thÃ nh!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:13px">ğŸ‘ Tá»‘t láº¯m!</p>
      <div style="font-weight:600;font-size:14px;margin:10px 0;color:#6b7280" id="winSuccessStats"></div>
      <div class="popup-actions"><button id="winSuccessClose" class="btn">âœ“ Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <!-- Auto-solve Completion Popup -->
  <div id="winAutoSolve" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-auto">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸ¤–ğŸ’¡</div>
      <h3 style="margin:0 0 6px 0;color:#7c3aed;font-size:20px;font-weight:800">Giáº£i Tá»± Äá»™ng!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:13px">ğŸ¯ Thuáº­t toÃ¡n hoÃ n thÃ nh</p>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#8b5cf6" id="winAutoSolveStats"></div>
      <div class="popup-actions"><button id="winAutoSolveClose" class="btn">ğŸ” Xem láº¡i</button></div>
    </div>
  </div>

  <!-- Teach Mode Popup -->
  <div id="winTeach" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-teach">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸ“</div>
      <h3 style="margin:0 0 6px 0;color:#f59e0b;font-size:20px;font-weight:800">Chá»‰ cÃ³ váº­y thÃ´i Ä‘Ã³</h3>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#d97706" id="winTeachStats"></div>
      <div class="popup-actions"><button id="winTeachClose" class="btn">Tiáº¿p tá»¥c</button></div>
    </div>
  </div>

  <!-- Learn Mode  Popup -->
  <div id="winLearn" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-learn">
      <div style="font-size:52px;margin-bottom:8px;line-height:1">ğŸ§ ğŸ‘¨â€ğŸ«</div>
      <h3 style="margin:0 0 6px 0;color:#10b981;font-size:20px;font-weight:800">Há»c Xong Rá»“i!</h3>
      <p style="color:var(--muted);margin:6px 0;font-size:13px">ğŸ“š Báº¡n Ä‘Ã£ hoÃ n thÃ nh cháº¿ Ä‘á»™ Learn</p>
      <div style="font-weight:600;font-size:15px;margin:10px 0;color:#059669" id="winLearnStats"></div>
      <div class="popup-actions"><button id="winLearnClose" class="btn">ğŸ“– Tiáº¿p tá»¥c há»c</button></div>
    </div>
  </div>

  <!-- Sandbox Popup - Enhanced -->
  <div id="winSandbox" class="popup" role="dialog" aria-modal="true">
    <div class="popup-box win-sandbox" style="max-width: 480px;">
      <div id="winSandboxStats" style="color:#7c3aed"></div>
      <div class="popup-actions" style="margin-top:16px;">
        <button id="winSandboxClose" class="btn" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);font-weight:800;">ğŸ§ª ThÃ­ nghiá»‡m tiáº¿p theo</button>
      </div>
    </div>
  </div>

  <div id="analysisPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="analysisTitle">
    <div class="popup-box wide">
      <h3 id="analysisTitle" style="margin-top:0">ğŸ† Best score</h3>
      <div id="leaderboardList" style="text-align:left; max-height: 320px; overflow:auto"></div>
      <div class="popup-actions"><button id="analysisClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>

  <!-- Challenge Win Popups (moved here) -->
  <div id="challengeWinEasy" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeWinEasyTitle">
    <div class="popup-box">
      <div id="challengeWinEasyTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">ğŸ‰ ChÃºc má»«ng! (Challenge Dá»…)</div>
      <p style="color:var(--muted);margin:0">Báº¡n Ä‘Ã£ hoÃ n thÃ nh cháº¿ Ä‘á»™ Challenge (Dá»…). Tiáº¿p tá»¥c nÃ¢ng cáº¥p thá»­ thÃ¡ch nhÃ©!</p>
      <div class="popup-actions"><button id="challengeWinEasyClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>
  <div id="challengeWinMedium" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeWinMediumTitle">
    <div class="popup-box">
      <div id="challengeWinMediumTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">ğŸ… Tuyá»‡t vá»i! (Challenge Vá»«a)</div>
      <p style="color:var(--muted);margin:0">Báº¡n Ä‘Ã£ hoÃ n thÃ nh cháº¿ Ä‘á»™ Challenge (Vá»«a). HÃ£y chinh phá»¥c má»©c KhÃ³!</p>
      <div class="popup-actions"><button id="challengeWinMediumClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>
  <div id="challengeWinHard" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeWinHardTitle">
    <div class="popup-box">
      <div id="challengeWinHardTitle" style="font-weight:800;font-size:18px;margin-bottom:8px">ğŸ¥‡ Äá»‰nh cao! (Challenge KhÃ³)</div>
      <p style="color:var(--muted);margin:0">Báº¡n Ä‘Ã£ chinh phá»¥c Challenge (KhÃ³)! ThÃ nh tÃ­ch ráº¥t áº¥n tÆ°á»£ng!</p>
      <div class="popup-actions"><button id="challengeWinHardClose" class="btn">ÄÃ³ng</button></div>
    </div>
  </div>
  
  <div id="challengeDifficultyPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="challengeTitle">
      <div class="popup-box">
          <h3 id="challengeTitle" style="margin-top:0">Chá»n Ä‘á»™ khÃ³ Challenge</h3>
          <p style="color:var(--muted);margin:4px 0 12px;">Thá»i gian sáº½ Ä‘Æ°á»£c tÃ­nh dá»±a trÃªn sá»‘ Ä‘Ä©a.</p>
          <div class="popup-actions" style="flex-direction:column;">
              <button id="difficultyEasy" class="btn">ğŸ˜„ Dá»…</button>
              <button id="difficultyMedium" class="btn" style="background-color:#f39c12;">ğŸ˜ Vá»«a</button>
              <button id="difficultyHard" class="btn" style="background-color:#e74c3c;">ğŸ¥µ KhÃ³</button>
          </div>
      </div>
  </div>

  <div id="achievementsPopup" class="popup" role="dialog" aria-modal="true" aria-labelledby="achieveTitle">
        <div class="popup-box wide">
            <h3 id="achieveTitle" style="margin-top:0">ğŸ† ThÃ nh tÃ­ch & Danh hiá»‡u</h3>
            <p style="color:var(--muted);margin:4px 0 12px;">Má»Ÿ khÃ³a thÃ nh tÃ­ch Ä‘á»ƒ nháº­n danh hiá»‡u má»›i. Click vÃ o danh hiá»‡u Ä‘Ã£ má»Ÿ khÃ³a Ä‘á»ƒ trang bá»‹.</p>
            <div id="achievementsList" class="achievements-list">
                </div>
            <div class="popup-actions"><button id="achievementsClose" class="btn">ÄÃ³ng</button></div>
        </div>
    </div>
    
  <div id="achievementUnlockedPopup" class="finishPop" style="min-width:320px;display:flex;align-items:center;justify-content:center;flex-direction:column;"></div>

  <div id="loserPopup" class="popup" style="display:none" role="alert"><div class="popup-box"><div style="font-weight:900;font-size:20px;color:#d23"></div><div style="margin-top:12px"><button id="loserClose" class="btn">ÄÃ³ng</button></div></div></div>

  <div id="settingsPopup" class="settings-panel" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" style="display:none;">
      <div id="settingsHeader" class="settings-header">
          <h3 style="margin:0;font-size:16px;flex:1;cursor:move;">âš™ï¸ CÃ i Ä‘áº·t</h3>
          <button id="settingsMinimize" class="panel-btn" title="Thu gá»n">âˆ’</button>
          <button id="settingsCloseX" class="panel-btn" title="ÄÃ³ng">Ã—</button>
      </div>
      <div class="settings-content">
          
          <!-- Background Section -->
          <div style="margin-bottom:18px;">
              <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:14px;font-weight:700;">ğŸ¨ HÃ¬nh ná»n</h4>
              <div class="settings-grid">
                  <div class="setting-item">
                      <label for="bgImageUpload">áº¢nh ná»n Game:</label>
                      <input type="file" id="bgImageUpload" accept="image/*" class="image-upload">
                      <span id="bgImageStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
                  </div>
                  <div class="setting-item">
                      <label for="bgOpacity">Äá»™ má» ná»n:</label>
                      <input type="range" id="bgOpacity" min="0" max="100" value="100" style="width:100%">
                      <span id="bgOpacityValue" class="upload-status">100%</span>
                  </div>
              </div>
          </div>
          
          <!-- Audio Section -->
          <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:14px;font-weight:700;">ğŸµ Ã‚m thanh</h4>
          <div class="settings-grid">
              <div class="setting-item">
                  <label for="bgmUpload">Nháº¡c ná»n (BGM):</label>
                  <input type="file" id="bgmUpload" accept="audio/*" class="audio-upload">
                  <span id="bgmUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
              <div class="setting-item">
                  <label for="pickupUpload">Ã‚m thanh Nháº¥c Ä‘Ä©a:</label>
                  <input type="file" id="pickupUpload" accept="audio/*" class="audio-upload">
                  <span id="pickupUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
               <div class="setting-item">
                  <label for="dropUpload">Ã‚m thanh Äáº·t Ä‘Ä©a:</label>
                  <input type="file" id="dropUpload" accept="audio/*" class="audio-upload">
                  <span id="dropUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
               <div class="setting-item">
                  <label for="winUpload">Ã‚m thanh Chiáº¿n tháº¯ng:</label>
                  <input type="file" id="winUpload" accept="audio/*" class="audio-upload">
                  <span id="winUploadStatus" class="upload-status">Máº·c Ä‘á»‹nh</span>
              </div>
          </div>
          
          <!-- Cache Cleaner -->
          <div style="margin-top:20px;border-top:1px solid rgba(0,0,0,0.08);padding-top:16px;">
              <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:14px;font-weight:700;">ğŸ—‘ï¸ Quáº£n lÃ½ Bá»™ nhá»›</h4>
              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                  <button id="clearCache" class="ghost" style="flex:1;min-width:140px;font-size:12px;padding:6px 10px;">xÃ³a bá»™ nhá»› Ä‘á»‡m</button>
                  <button id="clearAllData" class="ghost" style="flex:1;min-width:140px;border-color:#dc2626;color:#dc2626;font-weight:900;font-size:11px;padding:6px 10px;">XÃ“A TOÃ€N Bá»˜ Dá»® LIá»†U</button>
              </div>
              <p style="color:var(--muted);font-size:11px;margin:6px 0 0 0;">âš ï¸ XÃ³a toÃ n bá»™ sáº½ xÃ³a achievements, best scores</p>
          </div>
          
          <div class="settings-footer">
              <button id="settingsReset" class="ghost" style="border-color:#e74c3c; color:#e74c3c;font-size:12px;padding:6px 10px;">KhÃ´i phá»¥c Máº·c Ä‘á»‹nh</button>
          </div>
      </div>
  </div>


  <audio id="bgm" loop preload="auto" data-default-src="./assets/audio/smooth-gaming-atmosphere-323659.mp3">
    <source src="./assets/audio/smooth-gaming-atmosphere-323659.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="snd_pickup" preload="auto" data-default-src="./assets/audio/pop-402324.mp3?filename=pop-402324.mp3">
    <source src="./assets/audio/pop-402324.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_drop" preload="auto" data-default-src="./assets/audio/beep-329314.mp3">
    <source src="./assets/audio/beep-329314.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_error" preload="auto" data-default-src="./assets/audio/error-126627.mp3">
    <source src="./assets/audio/error-126627.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_win" preload="auto" data-default-src="./assets/audio/votay.mp3">
    <source src="./assets/audio/votay.mp3" type="audio/mpeg">
  </audio>

  <audio id="snd_fireworks" preload="auto" data-default-src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2bb1d8a7a3.mp3?filename=fireworks.mp3">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2bb1d8a7a3.mp3?filename=fireworks.mp3" type="audio/mpeg">
  </audio>

  <!-- Daily Challenge Badge -->
  <div id="dailyChallengeBadge" class="daily-badge-pulse">
    <div style="font-size:16px;margin-bottom:2px">ğŸ¯ Daily Challenge</div>
    <div id="dailyCountdown" style="font-size:11px;opacity:0.9">--:--:--</div>
  </div>

  <!-- Stats Panel -->
  <div id="statsPanel">
    <div class="stats-header">
      <h3>ğŸ“Š Thá»‘ng kÃª Chi tiáº¿t</h3>
      <button id="statsClose" class="learn-close-btn">âœ•</button>
    </div>
    <div class="stats-content" id="statsContent"></div>
  </div>

  <!-- Daily Challenge Panel -->
  <div id="dailyChallengePanel">
    <div class="daily-header">
      <h3>ğŸ¯ Daily Challenge</h3>
    </div>
    <div class="daily-content" id="dailyChallengeContent"></div>
  </div>

  <!-- Mission Panel -->
  <div id="missionPanel">
    <div class="mission-header">
      <h3>ğŸ¯ Mission System</h3>
      <button id="missionClose" class="learn-close-btn">âœ•</button>
    </div>
    <div class="mission-content" id="missionContent"></div>
  </div>

  <div id="learnPanel" style="display:none">
    <div class="learn-header" id="learnHeader">
      <div class="learn-header-title">
        <span>ğŸ“š</span>
        <span>Learn Mode</span>
        <span style="font-size:11px;font-weight:600;opacity:0.9">n=<span id="learnN">4</span></span>
      </div>
      <div class="learn-header-actions">
        <button class="learn-collapse-btn" id="learnCollapseBtn" title="Thu gá»n (C)">âˆ’</button>
        <button class="learn-close-btn" id="learnCloseBtn" title="ÄÃ³ng (X)">âœ•</button>
      </div>
    </div>
    
    <div class="learn-content">
      <!-- Progress Bar -->
      <div class="learn-progress-container">
        <div class="learn-progress-bar" id="learnProgressBar"></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div class="learn-step-counter" id="learnStepCounter">BÆ°á»›c 0/0</div>
        <div class="learn-complexity" id="learnComplexity">O(2â¿)</div>
      </div>
      
      <div id="pseudoCodeArea">
        <div class="code-line" data-line="0"><b>Hanoi</b>(k, from, to, aux):</div>
        <div class="code-line" data-line="1" style="padding-left: 1em;">IF k > 0 THEN</div>
        <div class="code-line" data-line="2" style="padding-left: 2em;">Hanoi(k-1, from, aux, to)</div>
        <div class="code-line" data-line="3" style="padding-left: 2em;">Move disk k from <b>from</b> to <b>to</b></div>
        <div class="code-line" data-line="4" style="padding-left: 2em;">Hanoi(k-1, aux, to, from)</div>
        <div class="code-line" data-line="5" style="padding-left: 1em;">END IF</div>
    </div>
    
    <div id="stackArea"></div>
    <div id="learnExplain"></div>
    <div style="display:flex;gap:8px;margin-top:10px;justify-content:center">
      <button id="learnPrev" class="ghost" title="Previous (â†)">â—€ Prev</button>
      <button id="learnPlay" class="btn" title="Play (Space)">â–¶ Play</button>
      <button id="learnPause" class="ghost" style="display:none" title="Pause (Space)">â¸ Pause</button>
      <button id="learnNext" class="ghost" title="Next (â†’)">Next â–¶</button>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:12px">
      <label style="font-size:13px;color:var(--muted);flex:1">Speed:
        <select id="learnSpeed" class="speed-select"><option value="1200">Slow</option><option value="700" selected>Medium</option><option value="300">Fast</option></select>
      </label>
      <div style="font-size:11px;color:var(--muted);text-align:right">âŒ¨ï¸ â†â†’ Space C X</div>
    </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.12.0/tsparticles.confetti.bundle.min.js"></script>
<script src="./js/enh.js?v=20241105001" defer></script>
<script src="./js/ap2.js?v=20241109001" defer></script>
<!-- Modules for future maintenance - not used in production -->
<!-- <script type="module" src="./js/modules/main.js"></script> -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('./js/service-worker.js').catch(function(){});
    });
  }
  </script>
</body>
</html>